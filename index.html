<!DOCTYPE html>

<html lang="en">

<head>

<meta charset="UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Moon's Hearth - Triple Realm Hub</title>

<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

<style>

    :root { --gold: #d4af37; --gold-glow: rgba(212, 175, 55, 0.6); --fire: #ff6a00; --glass: rgba(10, 8, 6, 0.85); --text: #fdf5e6; --parchment: #e3d5b8; --ink: #2c1810; --spend: #c84b31; --water: #40e0d0; }

    body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: 'Cormorant Garamond', serif; background-color: #000; color: var(--text); overflow: hidden; }



    /* --- CUSTOM SCROLLBARS --- */

    ::-webkit-scrollbar { width: 8px; }

    ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.2); border-radius: 4px; }

    ::-webkit-scrollbar-thumb { background: rgba(212, 175, 55, 0.5); border-radius: 4px; border: 1px solid #8b5a2b; }

    ::-webkit-scrollbar-thumb:hover { background: var(--gold); }



    /* --- ENTER OVERLAY --- */

    #enter-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, #1a120e 0%, #000 100%); z-index: 9000; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 1.2s ease; }

    .enter-btn, .portal-btn, .data-btn { font-family: 'Cinzel', serif; color: var(--gold); background: rgba(0,0,0,0.6); border: 1px solid var(--gold); cursor: pointer; transition: 0.3s; }

    .enter-btn { font-size: 1.5rem; padding: 15px 45px; letter-spacing: 5px; text-transform: uppercase; box-shadow: 0 0 30px var(--gold-glow); }



    .golden-text {

        background: linear-gradient(to right, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);

        -webkit-background-clip: text;

        background-clip: text;

        color: transparent;

    }



    /* --- FIXED WIDGETS (The Soul and Weather) --- */

    .status-widget { 

        position: fixed !important; bottom: 30px; z-index: 8000 !important; 

        background: radial-gradient(circle, rgba(40, 30, 20, 0.9) 0%, rgba(10, 8, 5, 0.95) 100%);

        border: 2px solid var(--gold); width: 110px; height: 110px; border-radius: 50%;

        display: flex; flex-direction: column; align-items: center; justify-content: center;

        box-shadow: 0 0 20px rgba(0,0,0,0.8), inset 0 0 15px var(--gold-glow);

        transition: 0.8s; opacity: 0; pointer-events: none; overflow: hidden;

    }

    .status-widget.visible { opacity: 1; pointer-events: auto; }

    #weather-widget { left: 30px; }

    #soul-compass-widget { right: 30px; padding: 0; cursor: pointer; }

    #soul-compass-widget:hover { transform: scale(1.05); box-shadow: 0 0 25px var(--gold-glow); }

    

    #weather-icon { font-size: 2rem; margin-bottom: 2px; filter: drop-shadow(0 0 8px var(--gold)); }

    #weather-temp { font-family: 'Cinzel'; color: var(--gold); font-size: 1.2rem; font-weight: 900; }

    #weather-desc { font-family: 'Cormorant Garamond'; color: var(--parchment); font-size: 0.6rem; font-style: italic; letter-spacing: 1px; text-transform: uppercase; }



    /* --- NAVIGATION --- */

    .room-portal { position: fixed; left: 30px; top: 30px; z-index: 5000; display: flex; gap: 10px; }

    .portal-btn { padding: 10px 15px; font-size: 0.8rem; letter-spacing: 2px; text-transform: uppercase; }

    .portal-btn.active { background: var(--gold); color: #000; box-shadow: 0 0 15px var(--gold-glow); }



    /* --- ROOM LAYERS --- */

    .layer-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; transition: opacity 1s ease; background-size: cover; background-position: center; z-index: 10; }

    .hidden { opacity: 0; pointer-events: none; }



    /* UI PANELS */

    .glass-panel { background: var(--glass); backdrop-filter: blur(15px); border: 1px solid var(--gold-glow); padding: 20px; box-shadow: 0 15px 35px #000; }

    .scholar-input { width: 100%; background: rgba(0,0,0,0.5); border: 1px solid var(--gold-glow); color: var(--parchment); padding: 10px; font-family: 'Cormorant Garamond'; margin-bottom: 10px; outline: none; box-sizing: border-box; }

    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; text-align: center; font-size: 0.7rem; font-family: 'Cinzel'; }

    .day-num { padding: 5px; border: 1px solid rgba(212,175,55,0.1); cursor:pointer; }

    .day-num.today { background: var(--gold); color: #000; }

    .day-num.has-log { border-color: var(--gold); color: var(--gold); }



    /* --- CLICK ZONES --- */

    .click-zone { position: absolute; cursor: pointer; transition: 0.3s; z-index: 100; }

    .click-zone:hover { box-shadow: inset 0 0 30px var(--gold-glow); background: rgba(212,175,55,0.1); }



    /* Hearth UI Layout */

    .hearth-ui { position: fixed; right: 40px; top: 50%; transform: translateY(-50%); z-index: 2000; width: 420px; display: flex; flex-direction: column; gap: 15px; }



    /* --- ROOM 1: HEARTH --- */

    #hearth-layer { background-image: url('image_5.png'); }

    #zone-soups { top: 30%; left: 10%; width: 12%; height: 15%; }

    #zone-breads { top: 50%; left: 8%; width: 12%; height: 15%; }

    #zone-casseroles { top: 70%; left: 10%; width: 12%; height: 15%; }

    #zone-fried { top: 40%; left: 25%; width: 12%; height: 15%; }

    #zone-beverages { top: 60%; left: 25%; width: 12%; height: 15%; }



    /* --- ROOM 2: TOWER --- */

    #scholar-video-bg { width: 100%; height: 100%; object-fit: cover; position: absolute; }

    #zone-lore { top: 58%; left: 5%; width: 18%; height: 25%; } 

    #zone-merchant { top: 75%; left: 68%; width: 25%; height: 15%; } 

    .desk-ui-container { position: fixed; right: -450px; top: 50%; transform: translateY(-50%); width: 380px; z-index: 2000; transition: right 0.6s cubic-bezier(0.2, 0.8, 0.2, 1); }

    .desk-ui-container.open { right: 40px; } 



    /* --- ROOM 3: READING NOOK --- */

    #nook-layer { background-image: url('garden_bg.png'); background-color: #111; }

    #zone-oracle { top: 40%; left: 30%; width: 15%; height: 20%; }

    #zone-dream { top: 60%; left: 55%; width: 15%; height: 20%; }

    .nook-ui-container { position: fixed; right: -450px; top: 50%; transform: translateY(-50%); width: 420px; z-index: 2000; transition: right 0.6s cubic-bezier(0.2, 0.8, 0.2, 1); }

    .nook-ui-container.open { right: 40px; }



    /* --- ROOM 4: THE CELLAR --- */

    #cellar-layer { background-image: url('cellar_bg.png'); background-color: #080604; }

    #zone-safe { top: 50%; left: 20%; width: 15%; height: 25%; }

    #zone-workbench { top: 40%; left: 50%; width: 20%; height: 20%; }

    #zone-crate { top: 65%; left: 75%; width: 15%; height: 20%; }



    /* --- ROOM 5: THE HEALING SPRINGS --- */

    #springs-layer { background-image: url('springs_bg.jpg'); background-color: #051014; }

    #zone-vanity { top: 40%; left: 5%; width: 15%; height: 35%; }

    #zone-pool { top: 60%; left: 35%; width: 30%; height: 25%; }

    #zone-apothecary { top: 20%; right: 5%; width: 18%; height: 60%; }


    /* --- MODALS --- */

    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 10000; display: none; justify-content: center; align-items: center; opacity: 0; transition: 0.5s; }

    .scroll-parchment { background: var(--parchment); color: var(--ink); width: 90%; max-width: 700px; padding: 40px; border-radius: 5px 40px; position: relative; box-shadow: 0 0 50px #000; border: 2px solid #8b5a2b; height: 85vh; display: flex; flex-direction: column; overflow-y: auto; }

    

    .progress-track { width: 100%; height: 15px; background: rgba(0,0,0,0.1); border-radius: 5px; margin: 10px 0; border: 1px solid #8b5a2b; overflow: hidden; }

    .progress-fill { height: 100%; background: var(--gold); width: 0%; transition: width 0.5s ease; }



    .lexicon-item { display: flex; justify-content: space-between; border-bottom: 1px solid rgba(139, 90, 43, 0.1); padding: 10px 0; }

    .legend-item { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(139,90,43,0.1); }



    /* Animations */

    .ember, .dust-mote, .steam { pointer-events: none; }

    .ember { position: absolute; bottom:-20px; background:var(--fire); width: 5px; height: 5px; border-radius:50%; box-shadow:0 0 10px var(--fire); opacity:0; animation:rise linear infinite; }

    .dust-mote { position: absolute; background: rgba(255, 230, 180, 0.4); border-radius: 50%; opacity: 0; animation: floatDust linear infinite; }

    .steam { position: absolute; bottom: 10%; background: rgba(64, 224, 208, 0.15); border-radius: 50%; filter: blur(15px); opacity: 0; animation: riseSteam linear infinite; }

    

    @keyframes rise { 0% {opacity:0; transform:translateY(0);} 20% {opacity:0.8;} 100% {opacity:0; transform:translateY(-110vh) translateX(var(--drift));} }

    @keyframes floatDust { 0% { opacity: 0; transform: translateY(0); } 50% { opacity: 0.6; } 100% { opacity: 0; transform: translateY(-40vh) translateX(30px); } }

    @keyframes riseSteam { 0% {opacity:0; transform:translateY(0) scale(1);} 50% {opacity:0.6; transform:translateY(-30vh) scale(2.5);} 100% {opacity:0; transform:translateY(-60vh) scale(4) translateX(var(--drift));} }

</style>

</head>

<body>



    <div id="enter-overlay">

        <h2 class="golden-text" style="font-family:'Cinzel'; letter-spacing:10px; margin-bottom:30px;">MOON'S HEARTH</h2>

        <button class="enter-btn" onclick="igniteRealm()">Enter the Realm</button>

    </div>



    <div class="room-portal">

        <button id="btn-hearth" class="portal-btn active" onclick="switchRoom('hearth')">The Hearth</button>

        <button id="btn-scholar" class="portal-btn" onclick="switchRoom('scholar')">Scholar's Tower</button>

        <button id="btn-nook" class="portal-btn" onclick="switchRoom('nook')">Reading Nook</button>

        <button id="btn-cellar" class="portal-btn" onclick="switchRoom('cellar')">The Cellar</button>

        <button id="btn-springs" class="portal-btn" onclick="switchRoom('springs')">Healing Springs</button>

    </div>



    <div id="hearth-layer" class="layer-container">

        <div id="embers-container"></div>

        <div id="zone-soups" class="click-zone" onclick="openGrimoire('Soups & Stews')"></div>

        <div id="zone-breads" class="click-zone" onclick="openGrimoire('Breads & Bakes')"></div>

        <div id="zone-casseroles" class="click-zone" onclick="openGrimoire('Casseroles')"></div>

        <div id="zone-fried" class="click-zone" onclick="openGrimoire('Fried Delights')"></div>

        <div id="zone-beverages" class="click-zone" onclick="openGrimoire('Elixirs & Beverages')"></div>

        <div class="hearth-ui">

            <div class="glass-panel">

                <div class="panel-header"><h1 class="golden-text">The Almanac</h1></div>

                <div class="calendar-grid" id="calendar-body"></div>

            </div>

            <div class="glass-panel">

                <div class="panel-header"><h1 class="golden-text">Reagent List</h1></div>

                <div style="display:flex; gap:8px;">

                    <input type="text" id="reagent-input" class="scholar-input" placeholder="Add ingredient...">

                    <button class="data-btn" onclick="addReagent()">Add</button>

                </div>

                <div id="reagent-display" style="margin-top:10px; max-height:100px; overflow-y:auto; margin-bottom:15px; font-size:0.9rem;"></div>

                <button class="data-btn" style="width:100%" onclick="exportData()">Export Scroll</button>

            </div>

        </div>

    </div>



    <div id="scholar-layer" class="layer-container hidden">

        <video id="scholar-video-bg" loop muted playsinline><source src="scholar_bg.mp4" type="video/mp4"></video>

        <div id="dust-container"></div>

        <div id="zone-lore" class="click-zone" onclick="openGrimoire('Global Mythos')"></div>

        <div id="zone-merchant" class="click-zone" onclick="openGrimoire('Guild Logic')"></div>

        <button id="desk-toggle-btn" class="portal-btn ui-toggle-btn" onclick="toggleDeskUI()">Open Desk</button>

        <div id="desk-ui" class="desk-ui-container">

            <div class="glass-panel">

                <div class="panel-header"><h1 class="golden-text">Scholar's Focus</h1></div>

                <div id="timer-display" style="font-family:'Cinzel'; font-size:2.8rem; color:var(--gold); text-align:center;">25:00</div>

                <div style="display:flex; justify-content:center; gap:10px; margin: 15px 0;">

                    <button class="data-btn" onclick="startTimer(25)">Focus</button>

                    <button class="data-btn" onclick="stopTimer()">Reset</button>

                </div>

                <textarea id="work-note" class="scholar-input" placeholder="Log progress..."></textarea>

                <button class="data-btn" style="width:100%;" onclick="logWork()">Log Entry</button>

            </div>

            <div class="glass-panel" style="margin-top:10px;">

                <div id="blog-container" style="max-height: 150px; overflow-y: auto;"></div>

            </div>

        </div>

    </div>



    <div id="nook-layer" class="layer-container hidden">

        <div id="nook-particles"></div>

        <div id="zone-oracle" class="click-zone" onclick="drawOracleCard()"></div>

        <div id="zone-dream" class="click-zone" onclick="openDreamLedger()"></div>

        <button id="nook-toggle-btn" class="portal-btn ui-toggle-btn" onclick="toggleNookUI()">Spirit Alignment</button>

        <div id="nook-ui" class="nook-ui-container">

            <div class="glass-panel">

                <div class="panel-header"><h1 class="golden-text">Vital Alchemy</h1></div>

                <div class="mood-icons">

                    <span onclick="setMood('ethereal', this)">‚ú®</span>

                    <span onclick="setMood('grounded', this)">üåø</span>

                    <span onclick="setMood('flickering', this)">üî•</span>

                    <span onclick="setMood('stormy', this)">‚õàÔ∏è</span>

                    <span onclick="setMood('waning', this)">üåë</span>

                </div>

                <div class="vital-stat"><span>Dream Cycle</span> <input type="number" id="sleep-input" class="vital-input" onchange="saveVitals()"></div>

                <div class="vital-stat"><span>Restorative Elixir</span> <input type="number" id="water-input" class="vital-input" onchange="saveVitals()"></div>

                <div class="vital-stat"><span>Mana Sustenance</span> <input type="number" id="meal-input" class="vital-input" onchange="saveVitals()"></div>

            </div>

        </div>

    </div>



    <div id="cellar-layer" class="layer-container hidden">

        <div id="cellar-particles"></div>

        <div id="zone-safe" class="click-zone" onclick="openModal('safe-modal')"></div>

        <div id="zone-workbench" class="click-zone" onclick="openModal('workbench-modal')"></div>

        <div id="zone-crate" class="click-zone" onclick="openModal('crate-modal')"></div>

    </div>



    <div id="springs-layer" class="layer-container hidden">

        <div id="springs-particles"></div>

        <div id="zone-vanity" class="click-zone" onclick="openModal('vanity-modal')"></div>

        <div id="zone-pool" class="click-zone" onclick="openModal('pool-modal')"></div>

        <div id="zone-apothecary" class="click-zone" onclick="openModal('apothecary-modal')"></div>

    </div>



    <div id="soul-compass-widget" class="status-widget" onclick="openCompass()">

        <img src="avatar.jpg" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.parentNode.innerHTML='üõ°Ô∏è'">

    </div>



    <div id="weather-widget" class="status-widget">

        <div id="weather-icon">‚ú®</div>

        <div id="weather-temp">--¬∞F</div>

        <div id="weather-desc">Scrying...</div>

    </div>



    <audio id="audio-hearth" loop src="fire.mp3"></audio>

    <audio id="audio-nook" loop src="nature.mp3"></audio>

    <audio id="audio-cellar" loop src="cellar.mp3"></audio>

    <audio id="audio-springs" loop src="springs.mp3"></audio>



    <div id="grimoire-modal" class="modal-overlay" onclick="closeModal('grimoire-modal')">

        <div class="scroll-parchment" onclick="event.stopPropagation()">

            <h2 id="grimoire-title" class="golden-text" style="text-align:center;"></h2>

            <textarea id="grimoire-text" class="grimoire-textarea" placeholder="Scribe your research..."></textarea>

            <button class="data-btn" onclick="saveGrimoire()" style="width:100%; background:var(--gold); color:#000;">Save Entry</button>

        </div>

    </div>



    <div id="safe-modal" class="modal-overlay" onclick="closeModal('safe-modal')">

        <div class="scroll-parchment" onclick="event.stopPropagation()">

            <h2 class="golden-text" style="text-align:center;">The Iron Safe</h2>

            <h3 style="text-align:center; font-size:1.5rem;">Vault: <span id="vault-total">0.00</span></h3>

            <div style="display:flex; gap:10px; margin: 15px 0;">

                <input type="text" id="transaction-desc" class="scholar-input" style="width:50%" placeholder="Desc & #tag">

                <input type="number" id="transaction-amt" class="scholar-input" style="width:30%" placeholder="+/- Amt">

                <button class="data-btn" onclick="addTransaction()">Log</button>

            </div>

            <div id="budget-list" style="margin-bottom:15px;"></div>

            <div id="transaction-list" style="overflow-y:auto; flex-grow:1;"></div>

        </div>

    </div>



    <div id="pool-modal" class="modal-overlay" onclick="closeModal('pool-modal')">

        <div class="scroll-parchment" onclick="event.stopPropagation()" style="text-align:center;">

            <h2 class="golden-text">The Reflection Pool</h2>

            <div id="breathe-circle-ui" class="breathe-circle"></div>

            <h3 id="breathe-text" style="color:var(--water); font-size:2rem;">Ready</h3>

            <div id="breathe-timer-text" style="font-size:1.5rem; margin: 15px 0;">00:00</div>

            <button class="data-btn" onclick="startBreathing(5)">Start 5m Reset</button>

            <button class="data-btn" onclick="stopBreathing()">Stop</button>

        </div>

    </div>



    <div id="compass-modal" class="modal-overlay" onclick="closeModal('compass-modal')">

        <div class="scroll-parchment" onclick="event.stopPropagation()" style="flex-direction:row; gap:30px;">

            <div style="flex:1; border:2px solid var(--gold); border-radius:8px; overflow:hidden;"><img src="avatar.jpg" style="width:100%; height:100%; object-fit:cover;"></div>

            <div style="flex:2;">

                <h2 class="golden-text">Keeper of the Hearth</h2>

                <div style="margin-top:20px;">

                    <p>Spirit: <span id="stat-mood">Unaligned</span></p>

                    <p>Legend Tier: <span id="stat-legend-level">0</span></p>

                    <div class="progress-track"><div id="stat-legend-bar" class="progress-fill"></div></div>

                </div>

            </div>

        </div>

    </div>



    <script>

        let currentRoom = 'hearth';

        let breatheInt, breatheTim;

        const ah = document.getElementById('audio-hearth'), an = document.getElementById('audio-nook'), ac = document.getElementById('audio-cellar'), as = document.getElementById('audio-springs'), sv = document.getElementById('scholar-video-bg');



        function igniteRealm() {

            document.getElementById('enter-overlay').style.opacity = '0';

            setTimeout(() => document.getElementById('enter-overlay').style.display = 'none', 1200);

            ah.play().catch(e => console.log("Audio blocked."));

            createEmbers(); createDust(); createSpringsSteam();

            renderCalendar(); renderReagents(); renderBlog(); loadVitals(); fetchWeather();

            document.getElementById('weather-widget').classList.add('visible');

            document.getElementById('soul-compass-widget').classList.add('visible');

        }



        function switchRoom(room) {

            if(room === currentRoom) return;

            currentRoom = room;

            document.querySelectorAll('.portal-btn').forEach(b => b.classList.remove('active'));

            document.getElementById('btn-'+room).classList.add('active');

            document.querySelectorAll('.layer-container').forEach(l => l.classList.add('hidden'));

            document.getElementById(room+'-layer').classList.remove('hidden');

            [ah, an, ac, as, sv].forEach(m => m.pause());

            if(room === 'hearth') ah.play();

            if(room === 'nook') an.play();

            if(room === 'cellar') ac.play();

            if(room === 'springs') as.play();

            if(room === 'scholar') { sv.muted=false; sv.play(); }

        }



        function openModal(id) {

            document.getElementById(id).style.display = 'flex';

            setTimeout(() => document.getElementById(id).style.opacity = '1', 10);

            if(id === 'safe-modal') updateVaultUI();

        }

        function closeModal(id) {

            document.getElementById(id).style.opacity = '0';

            setTimeout(() => document.getElementById(id).style.display = 'none', 500);

        }



        // --- Particles ---

        function createEmbers() {

            const c = document.getElementById('embers-container');

            for(let i=0; i<20; i++){

                let e = document.createElement('div'); e.className='ember';

                e.style.left = Math.random()*100+'%'; e.style.animationDuration = (Math.random()*5+4)+'s';

                e.style.setProperty('--drift', (Math.random()*100-50)+'px'); c.appendChild(e);

            }

        }

        function createDust() {

            const boxes = [document.getElementById('dust-container'), document.getElementById('nook-particles'), document.getElementById('cellar-particles')];

            boxes.forEach(b => { if(b){ for(let i=0; i<30; i++){

                let d = document.createElement('div'); d.className='dust-mote';

                d.style.left = Math.random()*100+'%'; d.style.top = Math.random()*100+'%';

                d.style.animationDuration = (Math.random()*10+8)+'s'; b.appendChild(d);

            }}});

        }

        function createSpringsSteam() {

            const c = document.getElementById('springs-particles');

            for(let i=0; i<10; i++){

                let s = document.createElement('div'); s.className='steam';

                s.style.left = (Math.random()*60+20)+'%'; s.style.animationDuration = (Math.random()*8+6)+'s';

                s.style.setProperty('--drift', (Math.random()*100-50)+'px'); c.appendChild(s);

            }

        }



        // --- Weather & Vitals ---

        async function fetchWeather() {

            try {

                const r = await fetch('https://api.open-meteo.com/v1/forecast?latitude=34.94&longitude=-88.52&current=temperature_2m,weather_code&temperature_unit=fahrenheit');

                const d = await r.json();

                document.getElementById('weather-temp').innerText = Math.round(d.current.temperature_2m) + "¬∞F";

                let icon = "‚ú®"; if(d.current.weather_code === 0) icon = "üåô";

                document.getElementById('weather-icon').innerText = icon;

                document.getElementById('weather-desc').innerText = "Farmington";

            } catch(e) {}

        }



        function setMood(m, el) { 

            document.querySelectorAll('.mood-icons span').forEach(s => s.style.opacity = '0.4');

            el.style.opacity = '1'; localStorage.setItem('vital-mood', m); 

        }

        function saveVitals() {

            localStorage.setItem('vital-sleep', document.getElementById('sleep-input').value);

            localStorage.setItem('vital-water', document.getElementById('water-input').value);

        }

        function loadVitals() {

            document.getElementById('sleep-input').value = localStorage.getItem('vital-sleep') || 8;

        }



        // --- Safe ---

        function addTransaction() {

            const d = document.getElementById('transaction-desc').value, a = document.getElementById('transaction-amt').value;

            if(!d || !a) return;

            const l = JSON.parse(localStorage.getItem('vault-ledger') || '[]');

            l.push({n: d, a: parseFloat(a), d: new Date().toLocaleDateString()});

            localStorage.setItem('vault-ledger', JSON.stringify(l));

            document.getElementById('transaction-desc').value = ''; document.getElementById('transaction-amt').value = '';

            updateVaultUI();

        }

        function updateVaultUI() {

            const l = JSON.parse(localStorage.getItem('vault-ledger') || '[]');

            let t = 0; document.getElementById('transaction-list').innerHTML = l.slice().reverse().map(b => {

                t += b.a; return `<div class="lexicon-item"><span>${b.n}</span><span style="color:${b.a>=0?'var(--gold)':'var(--spend)'}">${b.a.toFixed(2)}</span></div>`;

            }).join('');

            document.getElementById('vault-total').innerText = t.toFixed(2);

        }



        // --- Breathing ---

        function startBreathing(m) {

            let rem = m*60, inh = true;

            breatheInt = setInterval(() => {

                inh = !inh; document.getElementById('breathe-circle-ui').className = 'breathe-circle ' + (inh?'inhale':'exhale');

                document.getElementById('breathe-text').innerText = inh?"Inhale...":"Exhale...";

            }, 4000);

            breatheTim = setInterval(() => {

                rem--; let min = Math.floor(rem/60).toString().padStart(2,'0'), sec = (rem%60).toString().padStart(2,'0');

                document.getElementById('breathe-timer-text').innerText = `${min}:${sec}`;

                if(rem <= 0) stopBreathing();

            }, 1000);

        }

        function stopBreathing() { clearInterval(breatheInt); clearInterval(breatheTim); document.getElementById('breathe-text').innerText = "Ready"; }



        function openCompass() {

            document.getElementById('stat-mood').innerText = (localStorage.getItem('vital-mood') || "Unaligned").toUpperCase();

            openModal('compass-modal');

        }



        function toggleDeskUI() { document.getElementById('desk-ui').classList.toggle('open'); }

        function toggleNookUI() { document.getElementById('nook-ui').classList.toggle('open'); }

        

        // Basic Grimoire / Reagent hooks (Shortened)

        function openGrimoire(s) { activeGrimoire = `grim-${s}`; document.getElementById('grimoire-title').innerText = s; document.getElementById('grimoire-text').value = localStorage.getItem(activeGrimoire) || ''; openModal('grimoire-modal'); }

        function saveGrimoire() { localStorage.setItem(activeGrimoire, document.getElementById('grimoire-text').value); closeModal('grimoire-modal'); }

        function addReagent() { let i = document.getElementById('reagent-input'); if(!i.value) return; let r = JSON.parse(localStorage.getItem('reagents') || '[]'); r.push(i.value); localStorage.setItem('reagents', JSON.stringify(r)); i.value=''; renderReagents(); }

        function renderReagents() { document.getElementById('reagent-display').innerHTML = JSON.parse(localStorage.getItem('reagents') || '[]').map(i => `<div>‚ú¶ ${i}</div>`).join(''); }

        function renderCalendar() { let c = document.getElementById('calendar-body'); c.innerHTML=''; for(let i=1; i<=31; i++){ let d = document.createElement('div'); d.className='day-num'; d.innerText=i; c.appendChild(d); } }

        function renderBlog() {}

        function exportData() {}

    </script>

</body>

</html>
