<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moon's Hearth - The Scholar's Tower</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<style>
    :root { --gold: #d4af37; --gold-glow: rgba(212, 175, 55, 0.6); --fire: #ff6a00; --glass: rgba(10, 8, 6, 0.85); --text: #fdf5e6; --parchment: #e3d5b8; --ink: #2c1810; }
    body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: 'Cormorant Garamond', serif; background-color: #000; color: var(--text); overflow: hidden; }

    /* --- UI Core --- */
    #enter-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, #1a120e 0%, #000 100%); z-index: 3000; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 1.2s ease; }
    .enter-btn, .portal-btn, .data-btn { font-family: 'Cinzel', serif; color: var(--gold); background: rgba(0,0,0,0.6); border: 1px solid var(--gold); cursor: pointer; transition: 0.3s; }
    .enter-btn { font-size: 1.5rem; padding: 15px 45px; letter-spacing: 5px; text-transform: uppercase; box-shadow: 0 0 30px var(--gold-glow); }
    .enter-btn:hover { background: var(--gold); color: #000; box-shadow: 0 0 20px var(--gold-glow); }

    .room-portal { position: absolute; left: 30px; top: 30px; z-index: 2000; display: flex; gap: 10px; }
    .ui-toggle-btn { position: absolute; right: 30px; top: 30px; z-index: 2000; padding: 10px 20px; font-size: 0.9rem; letter-spacing: 2px; }

    /* --- CELESTIAL SCRYING LENS --- */
    .weather-widget { 
        position: absolute; top: 20px; right: 260px; z-index: 2500; 
        background: radial-gradient(circle, rgba(40, 30, 20, 0.9) 0%, rgba(10, 8, 5, 0.95) 100%);
        border: 2px solid var(--gold); width: 110px; height: 110px; border-radius: 50%;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        box-shadow: 0 0 20px rgba(0,0,0,0.8), inset 0 0 15px var(--gold-glow);
        transition: 0.8s; opacity: 0; pointer-events: none; overflow: hidden;
    }
    .weather-widget.visible { opacity: 1; pointer-events: auto; }
    #weather-icon { font-size: 2rem; z-index: 2; margin-bottom: 2px; filter: drop-shadow(0 0 8px var(--gold)); }
    #weather-temp { font-family: 'Cinzel'; color: var(--gold); font-size: 1.2rem; font-weight: 900; z-index: 2; text-shadow: 0 2px 4px #000; }
    #weather-desc { font-family: 'Cormorant Garamond'; color: var(--parchment); font-size: 0.6rem; font-style: italic; z-index: 2; letter-spacing: 1px; text-transform: uppercase; }

    /* --- LAYERING --- */
    .layer-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transition: opacity 1s ease; }
    .layer-container.hidden { opacity: 0; pointer-events: none; }

    #hearth-bg { background: url('image_5.png') no-repeat center center; background-size: cover; z-index: 10; }
    #embers-container { z-index: 11; pointer-events: none; }
    .ember { position: absolute; bottom:-20px; background:var(--fire); width: 5px; height: 5px; border-radius:50%; box-shadow:0 0 10px var(--fire); opacity:0; animation:rise linear infinite; }
    @keyframes rise { 0% {opacity:0; transform:translateY(0);} 20% {opacity:0.8;} 100% {opacity:0; transform:translateY(-110vh) translateX(var(--drift));} }
    .hearth-ui { position: absolute; right: 40px; top: 50%; transform: translateY(-50%); z-index: 15; width: 420px; display: flex; flex-direction: column; gap: 15px; }
    .glass-panel { background: var(--glass); backdrop-filter: blur(15px); border: 1px solid var(--gold-glow); padding: 20px; box-shadow: 0 15px 35px #000; }

    #scholar-video-bg { width: 100%; height: 100%; object-fit: cover; z-index: 20; position: absolute; opacity: 1; }
    #dust-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 21; pointer-events: none; overflow: hidden; }
    .dust-mote { position: absolute; background: rgba(255, 230, 180, 0.4); border-radius: 50%; animation: floatDust linear infinite; }
    @keyframes floatDust { 0% { opacity: 0; transform: translateY(0); } 50% { opacity: 0.8; } 100% { opacity: 0; transform: translateY(-40vh) translateX(30px); } }

    .click-zone { position: absolute; cursor: pointer; transition: 0.3s; z-index: 25; }
    .click-zone:hover { box-shadow: inset 0 0 30px var(--gold-glow), 0 0 15px var(--gold-glow); background: rgba(212,175,55,0.1); }
    #zone-lore { top: 58%; left: 5%; width: 18%; height: 25%; } 
    #zone-bard { top: 63%; right: 5%; width: 15%; height: 20%; } 
    #zone-art { top: 20%; left: 2%; width: 12%; height: 15%; } 
    #zone-survival { top: 55%; left: 53%; width: 10%; height: 20%; } 
    #zone-merchant { top: 75%; left: 68%; width: 25%; height: 15%; } 

    /* --- DESK --- */
    .desk-ui-container { position: absolute; right: -450px; top: 50%; transform: translateY(-50%); width: 380px; z-index: 26; transition: right 0.6s cubic-bezier(0.2, 0.8, 0.2, 1); }
    .desk-ui-container.open { right: 40px; } 
    .desk-panel { background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--gold-glow); padding: 20px; color: var(--parchment); }
    .scholar-input { width: 100%; background: rgba(0,0,0,0.5); border: 1px solid var(--gold-glow); color: var(--parchment); padding: 10px; font-family: 'Cormorant Garamond'; margin-bottom: 10px; outline: none; box-sizing:border-box; }
    #timer-display { font-family: 'Cinzel'; font-size: 2.2rem; color: var(--gold); text-align: center; margin: 10px 0; }
    .blog-container { max-height: 250px; overflow-y: auto; margin-top: 10px; }

    /* --- MODALS & GRIMOIRE --- */
    #log-modal, #grimoire-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 4000; display: none; justify-content: center; align-items: center; opacity: 0; transition: 0.5s; }
    .scroll-parchment { background: var(--parchment); color: var(--ink); width: 90%; max-width: 700px; padding: 40px; border-radius: 5px 40px; position: relative; box-shadow: 0 0 50px #000; border: 2px solid #8b5a2b; height: 85vh; display: flex; flex-direction: column; }
    
    .grimoire-tabs { display: flex; gap: 20px; margin-bottom: 15px; border-bottom: 1px solid #8b5a2b; }
    .tab-btn { background: none; border: none; font-family: 'Cinzel'; cursor: pointer; padding: 5px 10px; color: #8b5a2b; opacity: 0.5; transition: 0.3s; }
    .tab-btn.active { opacity: 1; border-bottom: 2px solid #8b5a2b; }

    #grimoire-toc { margin-bottom: 10px; display: flex; flex-wrap: wrap; gap: 10px; font-size: 0.8rem; font-family: 'Cinzel'; max-height: 40px; overflow-y: auto; }
    .toc-link { color: #8b5a2b; cursor: pointer; text-decoration: underline; opacity: 0.7; }

    .search-scryer { width: 100%; background: rgba(0,0,0,0.05); border: none; border-bottom: 1px solid #8b5a2b; font-family: 'Cinzel'; font-size: 0.7rem; padding: 5px 0; margin-bottom: 15px; outline: none; color: #8b5a2b; }
    .grimoire-textarea { width: 100%; flex-grow: 1; background: rgba(0,0,0,0.03); border: 1px solid rgba(139, 90, 43, 0.3); padding: 15px; font-family: 'Cormorant Garamond'; font-size: 1.2rem; line-height: 1.5; outline: none; resize: none; color: var(--ink); }

    /* Lexicon Specific */
    #lexicon-view { display: none; flex-direction: column; flex-grow: 1; overflow: hidden; }
    .lexicon-input-row { display: flex; gap: 10px; margin-bottom: 15px; }
    .lexicon-list { flex-grow: 1; overflow-y: auto; border: 1px solid rgba(139, 90, 43, 0.2); padding: 15px; background: rgba(0,0,0,0.02); }
    .lexicon-item { display: flex; align-items: flex-start; justify-content: space-between; border-bottom: 1px solid rgba(139, 90, 43, 0.1); padding: 10px 0; animation: fadeIn 0.3s ease; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    .lexicon-term { font-family: 'Cinzel'; font-weight: bold; color: #8b5a2b; width: 30%; font-size: 0.9rem; }
    .lexicon-def { width: 60%; font-family: 'Cormorant Garamond'; font-size: 1.1rem; line-height: 1.3; color: var(--ink); }
    .del-btn { cursor: pointer; color: #8a3324; opacity: 0.5; font-size: 1.2rem; padding: 0 5px; }
    .del-btn:hover { opacity: 1; }

    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; text-align: center; font-size: 0.7rem; font-family: 'Cinzel'; }
    .day-num { padding: 5px; border: 1px solid rgba(212,175,55,0.1); cursor:pointer; }
    .day-num.today { background: var(--gold); color: #000; }
    .day-num.has-log { border-color: var(--gold); color: var(--gold); }
</style>
</head>
<body>

    <div id="enter-overlay">
        <h2 style="font-family:'Cinzel'; color:var(--gold); letter-spacing:10px; margin-bottom:30px;">MOON'S HEARTH</h2>
        <button class="enter-btn" onclick="igniteRealm()">Enter the Realm</button>
    </div>

    <div class="room-portal">
        <button id="btn-hearth" class="portal-btn active" onclick="switchRoom('hearth')">The Hearth</button>
        <button id="btn-scholar" class="portal-btn" onclick="switchRoom('scholar')">Scholar's Tower</button>
    </div>

    <div id="weather-widget" class="weather-widget">
        <div id="weather-icon">âœ¨</div>
        <div id="weather-temp">--Â°F</div>
        <div id="weather-desc">Scrying...</div>
    </div>

    <audio id="audio-hearth" loop src="fire.mp3"></audio>

    <div id="hearth-layer" class="layer-container">
        <div id="hearth-bg" class="layer-container"></div>
        <div id="embers-container" class="layer-container"></div>
        <div class="hearth-ui">
            <div class="glass-panel"><div class="panel-header"><h1>The Almanac</h1></div><div class="calendar-grid" id="calendar-body"></div></div>
            <div class="glass-panel">
                <div class="panel-header"><h1>Reagent List</h1></div>
                <div style="display:flex; gap:8px;"><input type="text" id="reagent-input" class="scholar-input" placeholder="Add ingredient..."><button class="data-btn" onclick="addReagent()">Add</button></div>
                <div id="reagent-display" style="margin-top:10px; max-height:100px; overflow-y:auto; margin-bottom:15px;"></div>
                <div style="border-top: 1px solid var(--gold-glow); padding-top:15px; display:flex; justify-content:space-around;">
                    <button class="data-btn" style="font-size:0.7rem;" onclick="exportData()">Export Scroll</button>
                    <button class="data-btn" style="font-size:0.7rem;" onclick="document.getElementById('import-file').click()">Import Scroll</button>
                    <input type="file" id="import-file" style="display:none" onchange="importData(event)">
                </div>
            </div>
        </div>
    </div>

    <div id="scholar-layer" class="layer-container hidden">
        <video id="scholar-video-bg" loop muted playsinline><source src="scholar_bg.mp4" type="video/mp4"></video>
        <div id="dust-container"></div>
        <div class="scholar-click-layer layer-container">
            <div id="zone-lore" class="click-zone" onclick="openGrimoire('Global Mythos')"></div>
            <div id="zone-bard" class="click-zone" onclick="openGrimoire('Bardic Arts')"></div>
            <div id="zone-art" class="click-zone" onclick="openGrimoire('Visual Design')"></div>
            <div id="zone-survival" class="click-zone" onclick="openGrimoire('Hearth Resilience')"></div>
            <div id="zone-merchant" class="click-zone" onclick="openGrimoire('Guild Logic')"></div>
        </div>
        <button id="desk-toggle-btn" class="portal-btn ui-toggle-btn" onclick="toggleDeskUI()">Open Desk</button>
        <div id="desk-ui" class="desk-ui-container">
            <div class="desk-panel">
                <div id="timer-display">00:00</div>
                <div style="display:flex; justify-content:center; gap:10px; margin-bottom:15px;">
                    <button class="data-btn" onclick="startTimer(25)">Focus</button>
                    <button class="data-btn" onclick="stopTimer()">Reset</button>
                </div>
                <textarea id="work-note" class="scholar-input" placeholder="Record your progress..."></textarea>
                <button class="data-btn" style="width:100%;" onclick="logWork()">Log Entry</button>
            </div>
            <div class="desk-panel" style="margin-top:10px;"><h3 style="font-family:'Cinzel'; color:var(--gold); font-size:0.9rem; text-align:center;">Master's Journal</h3><div id="blog-container" class="blog-container"></div></div>
        </div>
    </div>

    <div id="grimoire-modal" onclick="closeGrimoire()">
        <div class="scroll-parchment" onclick="event.stopPropagation()">
            <span style="position:absolute; top:15px; right:20px; cursor:pointer;" onclick="closeGrimoire()">Ã—</span>
            <div class="grimoire-tabs">
                <button id="tab-grim" class="tab-btn active" onclick="toggleView('grim')">Grimoire</button>
                <button id="tab-lex" class="tab-btn" onclick="toggleView('lex')">Lexicon</button>
            </div>
            <h2 id="grimoire-title" style="font-family:'Cinzel'; text-align:center; margin-bottom:10px;"></h2>
            
            <div id="grimoire-view" style="display:flex; flex-direction:column; flex-grow:1;">
                <div id="grimoire-toc"></div>
                <input type="text" id="grimoire-search" class="search-scryer" placeholder="Scry Lexicon (Search)..." oninput="scryText()">
                <textarea id="grimoire-text" class="grimoire-textarea" oninput="updateTOC()" placeholder="Scribe your research... use '#' for chapters."></textarea>
                <button class="data-btn" onclick="saveGrimoire()" style="width:100%; margin-top:15px; color:#000; background:var(--gold); padding:10px;">Scribe to Grimoire</button>
            </div>

            <div id="lexicon-view">
                <div class="lexicon-input-row">
                    <input type="text" id="lex-term" class="scholar-input" style="width:30%" placeholder="New Term...">
                    <input type="text" id="lex-def" class="scholar-input" style="width:60%" placeholder="Definition...">
                    <button class="data-btn" onclick="addLexicon()">Add</button>
                </div>
                <div class="lexicon-list" id="lexicon-list"></div>
            </div>
        </div>
    </div>

    <div id="log-modal" onclick="closeLog()"><div class="scroll-parchment" onclick="event.stopPropagation()" style="height:auto;"><span style="position:absolute; top:15px; right:20px; cursor:pointer;" onclick="closeLog()">Ã—</span><h2 id="log-date-title" style="font-family:'Cinzel'; text-align:center; margin-bottom:20px;"></h2><textarea id="log-entry" style="width:100%; height:200px; background:rgba(0,0,0,0.05); border:1px solid #8b5a2b; padding:15px; font-family:serif; font-size:1.1rem; outline:none;"></textarea><button class="data-btn" onclick="saveLog()" style="width:100%; margin-top:20px; color:#000; background:var(--gold); padding:10px;">Finalize Record</button></div></div>

    <script>
        let currentRoom = 'hearth'; let timerInterval; let secondsRemaining = 0; let selectedDate = ''; let activeGrimoire = '';
        const ah = document.getElementById('audio-hearth'); const sv = document.getElementById('scholar-video-bg');

        function igniteRealm() { document.getElementById('enter-overlay').style.opacity = '0'; setTimeout(() => { document.getElementById('enter-overlay').style.display = 'none'; }, 1200); ah.volume = 0.5; ah.play(); createEmbers(); createDust(); renderCalendar(); renderReagents(); renderBlog(); fetchWeather(); document.getElementById('weather-widget').classList.add('visible'); }
        function switchRoom(room) { if(room === currentRoom) return; currentRoom = room; document.getElementById('btn-hearth').classList.toggle('active', room === 'hearth'); document.getElementById('btn-scholar').classList.toggle('active', room === 'scholar'); document.getElementById('hearth-layer').classList.toggle('hidden', room !== 'hearth'); document.getElementById('scholar-layer').classList.toggle('hidden', room !== 'scholar'); if(room === 'scholar') { ah.pause(); sv.muted = false; sv.volume = 0.4; sv.play(); } else { sv.pause(); ah.play(); } }
        async function fetchWeather() { try { const res = await fetch('https://api.open-meteo.com/v1/forecast?latitude=34.94&longitude=-88.52&current=temperature_2m,weather_code&temperature_unit=fahrenheit'); const data = await res.json(); document.getElementById('weather-temp').innerText = Math.round(data.current.temperature_2m) + "Â°F"; document.getElementById('weather-desc').innerText = "Farmington, MS"; let icon = "âœ¨"; const code = data.current.weather_code; if (code === 0) icon = "ðŸŒ™"; else if (code <= 3) icon = "â˜ï¸"; else if (code >= 51) icon = "ðŸŒ§ï¸"; document.getElementById('weather-icon').innerText = icon; } catch(e) { document.getElementById('weather-desc').innerText = "Skies obscured."; } }
        function toggleDeskUI() { document.getElementById('desk-ui').classList.toggle('open'); }

        function toggleView(view) {
            document.getElementById('grimoire-view').style.display = view === 'grim' ? 'flex' : 'none';
            document.getElementById('lexicon-view').style.display = view === 'lex' ? 'flex' : 'none';
            document.getElementById('tab-grim').classList.toggle('active', view === 'grim');
            document.getElementById('tab-lex').classList.toggle('active', view === 'lex');
            if(view === 'lex') renderLexicon();
        }

        function openGrimoire(subject) { activeGrimoire = `grim-${subject.replace(/\s+/g, '-').toLowerCase()}`; document.getElementById('grimoire-title').innerText = subject; document.getElementById('grimoire-text').value = localStorage.getItem(activeGrimoire) || ''; toggleView('grim'); document.getElementById('grimoire-modal').style.display = 'flex'; setTimeout(() => document.getElementById('grimoire-modal').style.opacity = '1', 10); }
        function saveGrimoire() { localStorage.setItem(activeGrimoire, document.getElementById('grimoire-text').value); closeGrimoire(); }
        function closeGrimoire() { document.getElementById('grimoire-modal').style.opacity = '0'; setTimeout(() => document.getElementById('grimoire-modal').style.display = 'none', 500); }

        function updateTOC() {
            const text = document.getElementById('grimoire-text').value; const toc = document.getElementById('grimoire-toc');
            const lines = text.split('\n'); toc.innerHTML = '<span>TOC: </span>';
            lines.forEach(line => { if(line.startsWith('#')) {
                const title = line.replace('#', '').trim(); const span = document.createElement('span'); span.className = 'toc-link'; span.innerText = title;
                span.onclick = () => { const area = document.getElementById('grimoire-text'); area.focus(); const index = text.indexOf(line); area.setSelectionRange(index, index + line.length); area.blur(); area.focus(); };
                toc.appendChild(span);
            }});
        }

        function addLexicon() {
            const term = document.getElementById('lex-term'); const def = document.getElementById('lex-def');
            if(!term.value || !def.value) return;
            const lex = JSON.parse(localStorage.getItem('lexicon') || '[]');
            lex.push({t: term.value, d: def.value}); 
            lex.sort((a,b) => a.t.localeCompare(b.t)); // Alphabetize
            localStorage.setItem('lexicon', JSON.stringify(lex));
            term.value = ''; def.value = ''; renderLexicon();
        }
        function renderLexicon() {
            const list = document.getElementById('lexicon-list'); const lex = JSON.parse(localStorage.getItem('lexicon') || '[]');
            list.innerHTML = lex.map((item, idx) => `<div class="lexicon-item"><div class="lexicon-term">${item.t}</div><div class="lexicon-def">${item.d}</div><span class="del-btn" onclick="removeLex(${idx})">Ã—</span></div>`).join('');
        }
        function removeLex(idx) { const lex = JSON.parse(localStorage.getItem('lexicon') || '[]'); lex.splice(idx, 1); localStorage.setItem('lexicon', JSON.stringify(lex)); renderLexicon(); }
        function scryText() { const query = document.getElementById('grimoire-search').value.toLowerCase(); const area = document.getElementById('grimoire-text'); if(!query) return; const index = area.value.toLowerCase().indexOf(query); if(index !== -1) { area.focus(); area.setSelectionRange(index, index + query.length); } }

        function createEmbers() { const p = document.getElementById('embers-container'); p.innerHTML = ''; for(let i=0; i<25; i++) { let e = document.createElement('div'); e.className = 'ember'; e.style.left = Math.random()*100+'%'; e.style.animationDuration = (Math.random()*5+4)+'s'; e.style.setProperty('--drift', (Math.random()*100 - 50)+'px'); p.appendChild(e); } }
        function createDust() { const p = document.getElementById('dust-container'); p.innerHTML = ''; for(let i=0; i<80; i++) { let d = document.createElement('div'); d.className = 'dust-mote'; let s = Math.random()*3+1+'px'; d.style.width = s; d.style.height = s; d.style.left = Math.random()*100+'%'; d.style.top = Math.random()*100+'%'; d.style.animationDuration = (Math.random()*10+8)+'s'; p.appendChild(d); } }
        function renderCalendar() { const cb = document.getElementById('calendar-body'); cb.innerHTML = ''; const n = new Date(); for(let i=1; i<=31; i++) { let d = document.createElement('div'); d.className = 'day-num'; d.innerText = i; let k = `log-${n.getFullYear()}-${n.getMonth()}-${i}`; if(localStorage.getItem(k)) d.classList.add('has-log'); if(i === n.getDate()) d.classList.add('today'); d.onclick = () => openLog(i, k); cb.appendChild(d); } }
        function openLog(d, k) { selectedDate = k; document.getElementById('log-date-title').innerText = `Record Day ${d}`; document.getElementById('log-entry').value = localStorage.getItem(k) || ''; document.getElementById('log-modal').style.display = 'flex'; setTimeout(() => document.getElementById('log-modal').style.opacity = '1', 10); }
        function saveLog() { const v = document.getElementById('log-entry').value; if(!v.trim()) localStorage.removeItem(selectedDate); else localStorage.setItem(selectedDate, v); closeLog(); renderCalendar(); }
        function closeLog() { document.getElementById('log-modal').style.opacity = '0'; setTimeout(() => document.getElementById('log-modal').style.display = 'none', 500); }
        function startTimer(m) { clearInterval(timerInterval); secondsRemaining = m*60; timerInterval = setInterval(() => { secondsRemaining--; let min = Math.floor(secondsRemaining/60).toString().padStart(2,'0'); let sec = (secondsRemaining%60).toString().padStart(2,'0'); document.getElementById('timer-display').innerText = `${min}:${sec}`; if(secondsRemaining <= 0) clearInterval(timerInterval); }, 1000); }
        function stopTimer() { clearInterval(timerInterval); document.getElementById('timer-display').innerText = "00:00"; }
        function logWork() { const n = document.getElementById('work-note').value; if(!n.trim()) return; const b = JSON.parse(localStorage.getItem('journal') || '[]'); b.unshift({ts: new Date().toLocaleString(), note: n}); localStorage.setItem('journal', JSON.stringify(b)); document.getElementById('work-note').value = ''; renderBlog(); }
        function renderBlog() { const c = document.getElementById('blog-container'); const b = JSON.parse(localStorage.getItem('journal') || '[]'); c.innerHTML = b.map(p => `<div style="margin-bottom:10px; border-left:2px solid var(--gold); padding-left:10px; font-size:0.9rem;"><div style="color:var(--gold); font-size:0.7rem;">${p.ts}</div>${p.note}</div>`).join(''); }
        function addReagent() { const i = document.getElementById('reagent-input'); if(!i.value) return; const r = JSON.parse(localStorage.getItem('reagents') || '[]'); r.push(i.value); localStorage.setItem('reagents', JSON.stringify(r)); i.value = ''; renderReagents(); }
        function renderReagents() { const d = document.getElementById('reagent-display'); const r = JSON.parse(localStorage.getItem('reagents') || '[]'); d.innerHTML = r.map((it, idx) => `<div style="font-size:0.9rem; margin-bottom:4px; display:flex; justify-content:space-between;"><span>âœ¦ ${it}</span><span style="color:#8a3324; cursor:pointer;" onclick="removeReagent(${idx})">Ã—</span></div>`).join(''); }
        function removeReagent(idx) { const r = JSON.parse(localStorage.getItem('reagents') || '[]'); r.splice(idx, 1); localStorage.setItem('reagents', JSON.stringify(r)); renderReagents(); }
        function exportData(){const d={}; for(let i=0;i<localStorage.length;i++){const k=localStorage.key(i);d[k]=localStorage.getItem(k);} const b=new Blob([JSON.stringify(d)],{type:'application/json'}); const u=URL.createObjectURL(b); const a=document.createElement('a'); a.href=u; a.download='moons-hearth-scroll.json'; a.click();}
        function importData(e){const f=e.target.files[0]; if(!f)return; const r=new FileReader(); r.onload=(ev)=>{const d=JSON.parse(ev.target.result); for(const k in d)localStorage.setItem(k,d[k]); location.reload();}; r.readAsText(f);}
    </script>
</body>
</html>
