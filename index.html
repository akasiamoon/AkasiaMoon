<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moon's Hearth - The Sovereign Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
<style>
    :root { --gold: #d4af37; --gold-glow: rgba(212, 175, 55, 0.4); --fire: #ff6a00; --glass: rgba(15, 12, 10, 0.9); --text: #fdf5e6; --parchment: #e3d5b8; --ink: #2c1810; }
    body, html { margin: 0; padding: 0; width: 100%; height: 100%; font-family: 'Cormorant Garamond', serif; background-color: #000; color: var(--text); overflow: hidden; }

    /* --- GLOBAL BACKGROUND LAYERS --- */
    .layer-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; transition: opacity 1.5s ease; background-size: cover; background-position: center; z-index: 1; }
    .hidden { display: none !important; }
    .invisible { opacity: 0; pointer-events: none; }
    #hearth-layer { background-image: url('image_5.png'); }
    #garden-layer { background-image: url('https://images.unsplash.com/photo-1518199266791-5375a83190b7?q=80&w=2070&auto=format&fit=crop'); }
    #scholar-video-bg { width: 100%; height: 100%; object-fit: cover; position: absolute; }

    /* --- NAVIGATION & TOGGLES --- */
    .room-portal { position: fixed; left: 30px; top: 30px; z-index: 2000; display: flex; gap: 10px; }
    .portal-btn, .data-btn { font-family: 'Cinzel', serif; color: var(--gold); background: rgba(0,0,0,0.6); border: 1px solid var(--gold); cursor: pointer; transition: 0.3s; padding: 8px 15px; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 2px; outline: none; }
    .portal-btn:hover, .portal-btn.active { background: var(--gold); color: #000; box-shadow: 0 0 15px var(--gold-glow); }

    .sidebar-toggle {
        position: fixed; right: 25px; top: 30px; z-index: 2000;
        width: 45px; height: 45px; border-radius: 50%; background: rgba(0,0,0,0.8);
        border: 1px solid var(--gold); color: var(--gold); cursor: pointer;
        display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
        transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .sidebar-toggle:hover { transform: rotate(15deg) scale(1.1); background: var(--gold); color: #000; }

    /* --- SIDEBAR SYSTEM --- */
    .sidebar { 
        position: fixed; right: -450px; top: 0; width: 420px; height: 100%; 
        background: var(--glass); backdrop-filter: blur(25px); border-left: 1px solid var(--gold-glow); 
        z-index: 1000; transition: right 0.7s cubic-bezier(0.19, 1, 0.22, 1); padding: 90px 35px 40px 35px; 
        box-sizing: border-box; overflow-y: auto; scrollbar-width: thin; scrollbar-color: var(--gold) transparent;
    }
    .sidebar.open { right: 0; }
    
    /* --- UI ELEMENTS --- */
    .panel-header h1 { font-family: 'Cinzel'; font-size: 1.1rem; color: var(--gold); text-align: center; border-bottom: 1px solid var(--gold); padding-bottom: 10px; margin-bottom: 25px; letter-spacing: 4px; text-transform: uppercase; }
    .section-box { margin-bottom: 25px; border: 1px solid rgba(212,175,55,0.2); padding: 20px; background: rgba(255,255,255,0.02); }
    
    .vital-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-family: 'Cinzel'; font-size: 0.8rem; }
    .vital-input { background: rgba(0,0,0,0.3); border: 1px solid var(--gold-glow); color: var(--gold); font-family: 'Cinzel'; width: 60px; text-align: center; padding: 5px; outline: none; }
    .scholar-input { width: 100%; background: rgba(0,0,0,0.4); border: 1px solid var(--gold-glow); color: var(--parchment); padding: 12px; font-family: 'Cormorant Garamond'; margin-bottom: 10px; outline: none; box-sizing: border-box; resize: vertical; }

    .mood-icons { display: flex; gap: 15px; font-size: 1.5rem; justify-content: center; margin: 10px 0; }
    .mood-icons span { cursor: pointer; opacity: 0.3; transition: 0.4s; }
    .mood-icons span.selected { opacity: 1; filter: drop-shadow(0 0 8px var(--gold)); transform: scale(1.2); }

    /* Almanac Grid */
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; text-align: center; font-size: 0.7rem; font-family: 'Cinzel'; }
    .day-num { padding: 8px 0; border: 1px solid rgba(212,175,55,0.1); transition: 0.3s; cursor: default; }
    .day-num.today { background: var(--gold); color: #000; font-weight: 900; }

    /* Particles */
    #particle-layer { pointer-events: none; position: absolute; top:0; left:0; width:100%; height:100%; z-index: 5; }
    .particle { position: absolute; border-radius: 50%; opacity: 0; animation: rise linear infinite; }
    @keyframes rise { 0% {opacity:0; transform:translateY(0);} 20% {opacity:0.6;} 100% {opacity:0; transform:translateY(-110vh) translateX(var(--drift));} }
</style>
</head>
<body onload="init()">

    <div class="room-portal">
        <button id="btn-hearth" class="portal-btn active" onclick="switchRoom('hearth')">Hearth</button>
        <button id="btn-scholar" class="portal-btn" onclick="switchRoom('scholar')">Tower</button>
        <button id="btn-garden" class="portal-btn" onclick="switchRoom('garden')">Garden</button>
    </div>

    <button id="ui-toggle" class="sidebar-toggle" onclick="toggleSidebar()">üìú</button>

    <audio id="audio-hearth" loop src="fire.mp3"></audio>
    <audio id="audio-garden" loop src="nature.mp3"></audio>

    <div id="hearth-layer" class="layer-container"></div>
    
    <div id="scholar-layer" class="layer-container invisible">
        <video id="scholar-video-bg" loop muted playsinline><source src="scholar_bg.mp4" type="video/mp4"></video>
    </div>

    <div id="garden-layer" class="layer-container invisible"></div>

    <div id="particle-layer"></div>

    <div id="main-sidebar" class="sidebar">
        
        <div id="side-hearth" class="side-content">
            <div class="panel-header"><h1>Hearth Almanac</h1></div>
            <div class="section-box">
                <div class="calendar-grid" id="calendar-body"></div>
            </div>
            <div class="section-box">
                <h3 style="font-family:'Cinzel'; font-size:0.8rem; color:var(--gold); margin-bottom:15px;">Apothecary Reagents</h3>
                <input type="text" id="reagent-input" class="scholar-input" placeholder="Scribe herb or mineral..." onkeydown="if(event.key==='Enter') addReagent()">
                <div id="reagent-display" style="max-height:150px; overflow-y:auto; font-size:1.1rem; border-top: 1px solid rgba(212,175,55,0.1); padding-top:10px;"></div>
            </div>
            <button class="data-btn" style="width:100%" onclick="exportData()">Export Data Scroll</button>
        </div>

        <div id="side-scholar" class="side-content hidden">
            <div class="panel-header"><h1>Scholar's Focus</h1></div>
            <div class="section-box" style="text-align:center;">
                <div id="timer-display" style="font-family:'Cinzel'; font-size:2.8rem; color:var(--gold); margin-bottom:15px; text-shadow: 0 0 10px var(--gold-glow);">25:00</div>
                <div style="display:flex; gap:10px; justify-content:center;">
                    <button class="data-btn" onclick="startFocusTimer(25)">Begin Focus</button>
                    <button class="data-btn" style="border-color:#8a3324; color:#8a3324;" onclick="resetTimer()">Reset</button>
                </div>
                <p style="font-size:0.8rem; font-style:italic; margin-top:15px; opacity:0.7;">Zen Mode: UI will collapse upon start.</p>
            </div>
            <div class="section-box">
                <h3 style="font-family:'Cinzel'; font-size:0.8rem; color:var(--gold);">Grimoire Entry</h3>
                <textarea id="work-note" class="scholar-input" style="height:120px;" placeholder="What lore are you unearthing?"></textarea>
                <button class="data-btn" style="width:100%;" onclick="logJournal()">Scribe to Journal</button>
            </div>
            <div id="journal-preview" style="max-height:150px; overflow-y:auto; font-size:0.9rem; opacity:0.8;"></div>
        </div>

        <div id="side-garden" class="side-content hidden">
            <div class="panel-header"><h1>Vital Alchemy</h1></div>
            <div class="section-box">
                <div style="font-family:'Cinzel'; text-align:center; color:var(--gold); font-size:0.8rem; margin-bottom:10px;">Spirit Alignment</div>
                <div class="mood-icons" id="mood-picker">
                    <span onclick="updateMood('ethereal', this)">‚ú®</span>
                    <span onclick="updateMood('grounded', this)">üåø</span>
                    <span onclick="updateMood('flickering', this)">üî•</span>
                    <span onclick="setMood('stormy', this)">‚õàÔ∏è</span>
                    <span onclick="setMood('waning', this)">üåë</span>
                </div>
            </div>
            <div class="section-box">
                <div class="vital-row"><span>Dream Cycles (Sleep)</span> <input type="number" id="sleep-in" class="vital-input" onchange="saveVitals()"></div>
                <div class="vital-row"><span>Restorative Elixir (Water)</span> <input type="number" id="water-in" class="vital-input" onchange="saveVitals()"></div>
                <div class="vital-row"><span>Mana Intake (Meals)</span> <input type="number" id="meal-in" class="vital-input" onchange="saveVitals()"></div>
            </div>
        </div>
    </div>

    <script>
        let currentRoom = 'hearth';
        let timerInstance;
        const audH = document.getElementById('audio-hearth');
        const audG = document.getElementById('audio-garden');
        const vidS = document.getElementById('scholar-video-bg');

        function init() {
            renderCalendar();
            loadVitals();
            loadReagents();
            loadJournal();
            createParticles('#ff6a00', 25); // Hearth Embers
            audH.volume = 0.4;
            audG.volume = 0.4;
            // Initially stay in Hearth
        }

        function toggleSidebar() {
            document.getElementById('main-sidebar').classList.toggle('open');
        }

        function switchRoom(room) {
            if(room === currentRoom) return;
            currentRoom = room;

            // UI Styling
            document.querySelectorAll('.portal-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-'+room).classList.add('active');
            
            // Layer Visibility
            document.querySelectorAll('.layer-container').forEach(l => l.classList.add('invisible'));
            document.getElementById(room+'-layer').classList.remove('invisible');

            // Sidebar Content
            document.querySelectorAll('.side-content').forEach(s => s.classList.add('hidden'));
            document.getElementById('side-'+room).classList.remove('hidden');

            // Soundscape Management
            audH.pause(); audG.pause(); vidS.pause();
            if(room === 'hearth') { audH.play(); createParticles('#ff6a00', 25); }
            if(room === 'garden') { audG.play(); createParticles('#a2d5ab', 15); }
            if(room === 'scholar') { 
                vidS.muted = false; 
                vidS.play(); 
                createParticles('rgba(255,255,255,0.2)', 40); 
            }
        }

        // --- ZEN FOCUS TIMER ---
        function startFocusTimer(minutes) {
            let seconds = minutes * 60;
            clearInterval(timerInstance);
            
            // ZEN MODE TRIGGER
            document.getElementById('main-sidebar').classList.remove('open');

            timerInstance = setInterval(() => {
                seconds--;
                let m = Math.floor(seconds/60);
                let s = seconds%60;
                document.getElementById('timer-display').innerText = `${m}:${s.toString().padStart(2,'0')}`;
                if(seconds <= 0) {
                    clearInterval(timerInstance);
                    document.getElementById('timer-display').innerText = "RESTORED";
                    new Audio('https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg').play(); // Soft notification
                    document.getElementById('main-sidebar').classList.add('open');
                }
            }, 1000);
        }

        function resetTimer() {
            clearInterval(timerInstance);
            document.getElementById('timer-display').innerText = "25:00";
        }

        // --- DATA PERSISTENCE ---
        function updateMood(mood, el) {
            document.querySelectorAll('.mood-icons span').forEach(s => s.classList.remove('selected'));
            el.classList.add('selected');
            localStorage.setItem('hub-mood', mood);
        }

        function saveVitals() {
            localStorage.setItem('hub-sleep', document.getElementById('sleep-in').value);
            localStorage.setItem('hub-water', document.getElementById('water-in').value);
            localStorage.setItem('hub-meals', document.getElementById('meal-in').value);
        }

        function loadVitals() {
            document.getElementById('sleep-in').value = localStorage.getItem('hub-sleep') || 8;
            document.getElementById('water-in').value = localStorage.getItem('hub-water') || 0;
            document.getElementById('meal-in').value = localStorage.getItem('hub-meals') || 0;
            const m = localStorage.getItem('hub-mood');
            if(m) {
                const map = {ethereal:0, grounded:1, flickering:2, stormy:3, waning:4};
                document.querySelectorAll('.mood-icons span')[map[m]].classList.add('selected');
            }
        }

        function addReagent() {
            const val = document.getElementById('reagent-input').value;
            if(!val) return;
            const r = JSON.parse(localStorage.getItem('hub-reagents') || '[]');
            r.push(val);
            localStorage.setItem('hub-reagents', JSON.stringify(r));
            document.getElementById('reagent-input').value = '';
            renderReagents();
        }

        function renderReagents() {
            const r = JSON.parse(localStorage.getItem('hub-reagents') || '[]');
            document.getElementById('reagent-display').innerHTML = r.map((item, i) => 
                `<div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>‚ú¶ ${item}</span><span style="color:#8a3324; cursor:pointer" onclick="removeReagent(${i})">√ó</span></div>`
            ).join('');
        }

        function removeReagent(i) {
            const r = JSON.parse(localStorage.getItem('hub-reagents') || '[]');
            r.splice(i, 1);
            localStorage.setItem('hub-reagents', JSON.stringify(r));
            renderReagents();
        }

        function logJournal() {
            const note = document.getElementById('work-note').value;
            if(!note) return;
            const j = JSON.parse(localStorage.getItem('hub-journal') || '[]');
            j.unshift({time: new Date().toLocaleString(), text: note});
            localStorage.setItem('hub-journal', JSON.stringify(j));
            document.getElementById('work-note').value = '';
            loadJournal();
        }

        function loadJournal() {
            const j = JSON.parse(localStorage.getItem('hub-journal') || '[]');
            document.getElementById('journal-preview').innerHTML = j.slice(0, 5).map(entry => 
                `<div style="border-bottom:1px solid rgba(212,175,55,0.1); padding:8px 0;"><small>${entry.time}</small><br>${entry.text}</div>`
            ).join('');
        }

        // --- DECORATIVE ENGINE ---
        function createParticles(color, count) {
            const layer = document.getElementById('particle-layer');
            layer.innerHTML = '';
            for(let i=0; i<count; i++) {
                let p = document.createElement('div');
                p.className = 'particle';
                p.style.left = Math.random() * 100 + '%';
                let size = Math.random() * 3 + 1 + 'px';
                p.style.width = size; p.style.height = size;
                p.style.background = color;
                p.style.boxShadow = `0 0 10px ${color}`;
                p.style.animationDuration = (Math.random() * 8 + 4) + 's';
                p.style.setProperty('--drift', (Math.random() * 120 - 60) + 'px');
                layer.appendChild(p);
            }
        }

        function renderCalendar() {
            const container = document.getElementById('calendar-body');
            const now = new Date();
            for(let i=1; i<=31; i++) {
                let d = document.createElement('div');
                d.className = 'day-num';
                d.innerText = i;
                if(i === now.getDate()) d.classList.add('today');
                container.appendChild(d);
            }
        }

        function exportData() {
            const data = {};
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                data[key] = localStorage.getItem(key);
            }
            const blob = new Blob([JSON.stringify(data)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sovereign_hub_data.json';
            a.click();
        }
    </script>
</body>
</html>
